#include<fstream.h>
#include<conio.h>
#include<stdio.h>
#include<iomanip.h>
#include<stdlib.h>
#include<string.h>
#define recsize1 50
#define max 10
#define fn1 "Employee.txt"
fstream file;
char buffer[80];


class Employee
{
	 public:
		  char key[5],name[30],salary[8],add[17],dob[20],phone[16];
		  void initialEmp();
		  void readEmp();
		  void storeEmp(int);
		  int removeEmp(int,char *);
		  int hashEmp(char *);
		  void displayallEmp();
		  void retrieveEmp(int addr,char k[]);
 };
 
 
 
 
 
 void Employee::initialEmp()
{
	int i,j;
	file.open(fn1,ios::in);
	if(!file)
	{
		file.open(fn1,ios::out);
		if(!file)
		{
			cout<<"Unable to open the file";
			getch();
			exit(1);
		}
		for(i=0;i<max;i++)
		{
			file.seekp(i*recsize1*5+i*2,ios::beg);
			for(j=0;j<(recsize1)*5;j++)
				file<<"#";
			file<<endl;
		}
		cout<<"Empty file created"<<endl;
	}
	file.close();
	return;
 }



void Employee::readEmp()
{
	cout<<"Enter the record key:";	gets(key);
	cout<<"Enter the name:";        gets(name);
	cout<<"Enter the salary:";      gets(salary);
	cout<<"Enter the add:";  		gets(add);
	cout<<"Enter the dob:";  		gets(phone);
	cout<<"Enter the phone:";       gets(dob);

	strcpy(buffer,key);             strcat(buffer,"|");
	strcat(buffer,name);            strcat(buffer,"|");
	strcat(buffer,salary);          strcat(buffer,"|");
	strcat(buffer,add);      		strcat(buffer,"|");
	strcat(buffer,phone);           strcat(buffer,"|");
	strcat(buffer,dob);             strcat(buffer,"|");
	return;
 }
int Employee::hashEmp(char* key)
{
	int i=0,sum=0;
	while(key[i]!='\0')
	{
		sum=sum+(key[i]-48);
		i++;
	}
	return sum % max;
}



void Employee::storeEmp(int addr)
{
   char dummy[10];
	int flag=0,i,j;
	file.open(fn1,ios::in|ios::out);
	file.seekp(addr*recsize1*5+addr*2);
	file.getline(dummy,5,'\n');
	if(strcmp(dummy,"####")==0)
	{
		 file.seekp(addr*recsize1*5+i*2);
		 file<<buffer;
		 flag=1;
	}
	else
	{
		for(i=0;i<5;i++)
		{
			file.seekg(addr*recsize1*5+i*recsize1+addr*2);
			file.getline(dummy,5,'\n');
			//cout<<"dummy "<<dummy<<addr*recsize1*5+i*recsize1+addr*2<<"\t";
			if(strcmp(dummy,"####")==0)
			{
				cout<<"\n Collision has occured\n";
				cout<<"Home address is "<<addr*recsize1*5+addr*2<<" Actual address is "<<addr*recsize1*5+i*recsize1+i*2<<"\n";
				file.seekp(addr*recsize1*5+i*recsize1+2*addr);
				file<<buffer;
				flag=1;
				//cout<<"break now\n";
				return;
			}
		}
		for(i=addr+1;i!=addr;i++)
		{
			if(i%max==0)
				i=0;
			for(j=0;j<5;j++)
			{
				file.seekg(i*recsize1*5+j*recsize1+2*i);
				file.getline(dummy,5,'\n');
				if(strcmp(dummy,"####")==0)
				{
					cout<<"\n Collision has occured\n";
					cout<<"Home address is "<<addr*recsize1*5+i*2<<" Actual address is "<<i*recsize1*5+j*recsize1+i*2<<"\n";
					file.seekp(i*recsize1*5+j*recsize1+2*i);
					file<<buffer;
					flag=1;
					return;
					// cout<<"Break now\n";
				}
			}
		}
	}
	if(i==addr && (!flag))
		cout<<"Hash file is full,record cannot be inserted\n";
	file.close();
	return;
}
